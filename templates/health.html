{{ template "base-health.html" . }}

{{ define "health-title" }}Health{{ end }}

{{ define "health-content" }}
<h1>System Health</h1>

<div class="card">
    <div style="display: flex; align-items: center">
        <div
            style="width: 50px; height: 50px; border-radius: 50%; margin-right: 20px;
                  {{ if .node_health }}
                    background-color: #4CAF50;
                  {{ else }}
                    background-color: #F44336;
                  {{ end }}"
        ></div>
        <div>
            <h2>Node Health</h2>
            <p>{{ if .node_health }}Healthy{{ else }}Unhealthy{{ end }}</p>
        </div>
    </div>
</div>

<div class="card">
    <h2>Container Health</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Health</th>
            </tr>
        </thead>
        <tbody>
            {{ range .containers }}
            <tr>
                <td>{{ .Name }}</td>
                <td class="status-{{ lower (containerStatus .Status) }}">
                    {{ containerStatus .Status }}
                </td>
                <td>
                    {{ if eq (containerStatus .Status) "Running" }}
                    <span style="color: #4caf50">●</span> Healthy {{ else }}
                    <span style="color: #f44336">●</span> Unhealthy {{ end }}
                </td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Service Health</h2>
    {{ range $service_name, $endpoints := .service_endpoints }}
    <h3>{{ $service_name }}</h3>
    <table>
        <thead>
            <tr>
                <th>Endpoint</th>
                <th>Health Status</th>
            </tr>
        </thead>
        <tbody>
            {{ range $endpoints }}
            <tr>
                <td>{{ .IPAddress }}:{{ .Port }}</td>
                <td>{{ .HealthStatus }}</td>
            </tr>
            {{ end }}
        </tbody>
    </table>
    {{ else }}
    <p>No services registered</p>
    {{ end }}
</div>
{{ end }}
